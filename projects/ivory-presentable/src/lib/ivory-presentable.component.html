<div class="ivpt-container">
  @if (!_isGridReady) {
    <div>Loading</div>
  }
  @else {
    <ng-container *ngTemplateOutlet="dtPrimeTemplate"></ng-container>
  }

  <ng-template #dtPrimeTemplate>
    <!-- Datatable Header -->
    <div class="ivpt-header">
      This is heading space
    </div>

    <!-- Datatable Content starts -->
    <div class="ivpt-content">

      <!-- Column headings of the table -->
      <div class="ivpt-content-head" role="row" aria-rowindex="1">
        @if (recordSelectionEnabled) {
          <div
            class="ivpt-head-cell"
          >
            <input #dtSelectAll type="checkbox"
              class="ivpt-all-select-checkbox"
              tabindex="-1"
              id="selectall"
              (change)="whenSelectAll($event)"
            />
          </div>
        }
        @for (colItem of columns; track colItem; let i=$index) {
          <div 
            class="ivpt-head-cell ivpt-flex-cell" 
            role="columnheader" 
            attr.aria-colindex="{{i+1}}" 
            (click)="doSort(colItem.field)"
            [style.min-width.px]="colItem.width"
          >
            {{colItem.displayText}}
            @if (_isSortApplied && _sortAppliedOn===colItem.field) {
              @if (_sortType==='ASC') {
                <span> &uarr;</span>
              }
              @else if (_sortType==='DESC') {
                <span> &darr;</span>
              }
            }
          </div>
        }
      </div>

      <!-- Filter space for each column  -->
      <div #dtFilters class="ivpt-filters-row">
        @if (recordSelectionEnabled) {
          <div class="ivpt-filter-cell ivpt-flex-cell" style="max-width: 45px;"></div>
        }
        @for (colItem of columns; track colItem; let i=$index) {
          <div class="ivpt-filter-cell ivpt-flex-cell">
            @if (colItem.hasFilter && filterConfig[colItem.field]['type']==='list') {
              <button class="ivpt-filter-trigger" (click)="toggleFilterPopover($event)">
                Filter
              </button>
              <div #filterPopover class="ivpt-filter-popover" aria-label="filter options" role="presentation">
                <ul class="ivpt-filter-options">
                  @for (optionItem of filterConfig[colItem.field]['options']; track optionItem) {
                    <li class="ivpt-filter-option">
                      <input 
                        type="checkbox" 
                        [name]="optionItem.option" 
                        id="{{colItem.field}}_{{optionItem.option}}"
                        [(ngModel)]="optionItem.isSelected"
                      />
                      <label class="filter-option-label" for="{{colItem.field}}_{{optionItem.option}}">
                        {{optionItem.option}}
                      </label>
                    </li>
                  }
                </ul>
                <button class="ivpt-filter-apply" (click)="applyFilter($event, 'list', colItem.field)">Apply</button>
              </div>
            }
            @else if (colItem.hasFilter && filterConfig[colItem.field]['type']==='text') {
              <input 
                class="ivpt-filter-input"
                type="text" 
                [name]="colItem.field"
                id="{{colItem.field}}"
                [(ngModel)]="filterConfig[colItem.field]['keyword']" 
                (keydown)="applyFilter($event, 'text', colItem.field)" 
              />
            }
          </div>
        }
      </div>

      <!-- Table rows -->
      <div #dtContentBody class="ivpt-content-body" role="rowgroup">
        @for (dataItem of currVisibleData; track dataItem; let i=$index) {
          <ivory-presentable-row
            [columns]="columns"
            [rowIndex]="i"
            [rowSelectionEnabled]="recordSelectionEnabled"
            [rowData]="dataItem"
          >
          </ivory-presentable-row>
        }
      </div>

    </div>
    <!-- Datatable Content ends -->

    <!-- Datatable Footer -->
    <div class="ivpt-footer">
      <div class="ivpt-records" role="status">
        Records: {{processedData.length}}
      </div>

      @if (_hasPagination) {
        <div class="ivpt-records" role="presentation">
          <label 
            for="folders-per-page"
            aria-hidden="false"
          >
          Records per page: 
          </label>
          <select name="perPageOptions" 
            id="folders-per-page" 
            tabindex="0"
            [(ngModel)]="page.size" 
            (change)="updatePerPageRecords()"
          >
            @for (p of page.sizeOptions; track p) {
              <option [value]="p">
                {{ p }}
              </option>
            }
          </select>
        </div>
      }

      @if (_showPagination) {
        <div class="ivpt-paginator">
          <button type="button" 
            aria-label="First page" 
            tabindex="0"
            class="ivpt-paginator-button" 
            [disabled]="page.current===1"
            [attr.aria-disabled]="page.current===1"
            (click)="goto(1)"
          >
            &laquo;
          </button>
          &nbsp;
          <button type="button" 
            aria-label="Previous page" 
            tabindex="0"
            class="ivpt-paginator-button" 
            [disabled]="page.current===1"
            [attr.aria-disabled]="page.current===1" 
            (click)="goto(page.current-1)"
          >
            &lsaquo;
          </button> &nbsp;
          <input
            class="pagination-current clr-input"
            type="text"
            size="2"
            id="go-to"
            [(ngModel)]="page.goto"
            (keydown.enter)="goto(null)"
          />
          &nbsp;/&nbsp;
          <span class="pages-total">
            {{ page.totalPages }}
          </span>
          &nbsp;
          <button type="button"
            aria-label="Next page" 
            tabindex="0"
            class="ivpt-paginator-button" 
            [disabled]="page.current===page.totalPages" 
            [attr.aria-disabled]="page.current===page.totalPages" 
            (click)="goto(page.current + 1)"
          >
            &rsaquo;
          </button>
          &nbsp;
          <button type="button"
            aria-label="Last page" 
            tabindex="0"
            class="ivpt-paginator-button" 
            [disabled]="page.current===page.totalPages" 
            [attr.aria-disabled]="page.current===page.totalPages" 
            (click)="goto(page.totalPages)"
          >
            &raquo;
          </button>
        </div>
      }
    </div>
  </ng-template>
</div>
