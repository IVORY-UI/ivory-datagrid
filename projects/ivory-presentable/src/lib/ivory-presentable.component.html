<div class="ivpt-container" [ngStyle]="{ 'height.px': gridHeight }">
  @if (!_isGridReady) {
    <div>Loading</div>
  }
  @else {
    <ng-container *ngTemplateOutlet="dtPrimeTemplate"></ng-container>
  }

  <ng-template #dtPrimeTemplate>
    <!-- Datatable Header -->
    <div class="ivpt-header">
      <div class="ivpt-column-controller">
        <button class="ivpt-column-controller-handle" (click)="_showController=!_showController">
          Columns
        </button>
        @if (_showController) {
          <div #ivptController class="ivpt-column-controller-modal">

          </div>
        }
      </div>
    </div>

    <!-- Datatable Content starts -->
    <div class="ivpt-content">

      <!-- Column headings of the table -->
      <div class="ivpt-content-head" role="row" aria-rowindex="1">
        @if (recordsSelectable) {
          <div
            class="ivpt-head-cell"
          >
            <input #ivptSelectAll type="checkbox"
              class="ivpt-all-select-checkbox"
              tabindex="-1"
              id="selectall"
              (change)="whenSelectAll($event)"
            />
          </div>
        }
        @for (colItem of columns; track colItem; let i=$index) {
          <div 
            class="ivpt-head-cell ivpt-flex-cell" 
            role="columnheader" 
            attr.aria-colindex="{{i+1}}" 
            (click)="doSort(colItem.field)"
            [style.min-width.px]="colItem.width"
          >
            <div class="ivpt-column-title">
              {{colItem.displayText}}
            </div>
            <div class="ivpt-column-ext">
              @if (_isSortApplied && _sortAppliedOn===colItem.field) {
                @if (_sortType==='ASC') {
                  <span class="ivpt-sort-identifier"> &uarr;</span>
                }
                @else if (_sortType==='DESC') {
                  <span class="ivpt-sort-identifier"> &darr;</span>
                }
              }
              <presentable-column-resizer></presentable-column-resizer>
            </div>
          </div>
        }
      </div>

      <!-- Filter space for each column  -->
      <div #ivpttFilters class="ivpt-filters-row">
        @if (recordsSelectable) {
          <div class="ivpt-filter-cell ivpt-flex-cell" style="max-width: 36px;"></div>
        }
        @for (colItem of columns; track colItem; let i=$index) {
          <div class="ivpt-filter-cell ivpt-flex-cell">
            @if (colItem.hasFilter && filterConfig[colItem.field]['type']==='list') {
              <button class="ivpt-filter-trigger" (click)="toggleFilterPopover($event)">
                Filter
              </button>
              <div #filterPopover class="ivpt-filter-popover" aria-label="filter options" role="presentation">
                <ul class="ivpt-filter-options">
                  @for (optionItem of filterConfig[colItem.field]['options']; track optionItem) {
                    <li class="ivpt-filter-option">
                      <input 
                        type="checkbox" 
                        [name]="optionItem.option" 
                        id="{{colItem.field}}_{{optionItem.option}}"
                        [(ngModel)]="optionItem.isSelected"
                      />
                      <label class="filter-option-label" for="{{colItem.field}}_{{optionItem.option}}">
                        {{optionItem.option}}
                      </label>
                    </li>
                  }
                </ul>
                <button class="ivpt-filter-apply" (click)="applyFilter($event, 'list', colItem.field)">Apply</button>
              </div>
            }
            @else if (colItem.hasFilter && filterConfig[colItem.field]['type']==='text') {
              <input 
                class="ivpt-filter-input"
                type="text" 
                [name]="colItem.field"
                id="{{colItem.field}}"
                [(ngModel)]="filterConfig[colItem.field]['keyword']" 
                (keydown)="applyFilter($event, 'text', colItem.field)" 
              />
            }
          </div>
        }
      </div>

      <!-- Table rows -->
      <div #ivptContentBody class="ivpt-content-body" role="rowgroup">
        @for (dataItem of currVisibleData; track dataItem; let i=$index) {
          <ivory-presentable-row
            [columns]="columns"
            [rowIndex]="i"
            [rowSelectionEnabled]="recordsSelectable"
            [rowData]="dataItem"
          >
          </ivory-presentable-row>
        }
      </div>

    </div>
    <!-- Datatable Content ends -->

    <!-- Datatable Paginator -->
    @if (hasPagination) {
      <div #ivptPaginator class="ivpt-paginator">
        <div class="ivpt-records-summary" role="status">
          {{((_pageCurrent-1)*recordsPerPage)+1}} to {{_pageCurrent * recordsPerPage}} of {{_recordsTotal}}
        </div>
  
        <div class="ivpt-records-options" role="presentation">
          <label for="folders-per-page" aria-hidden="false">
            Records per page: 
          </label>
          <select name="perPageOptions" 
            id="folders-per-page" 
            tabindex="0"
            [(ngModel)]="recordsPerPage" 
            (change)="updatePerPageRecords()"
          >
            @for (p of recordsPerPageOptions; track p) {
              <option [value]="p">
                {{ p }}
              </option>
            }
          </select>
        </div>
  
        @if (_showPagination) {
        <div class="">
          <button type="button" 
            aria-label="First page" 
            tabindex="0"
            class="ivpt-paginator-button" 
            [disabled]="_pageCurrent===1"
            [attr.aria-disabled]="_pageCurrent===1"
            (click)="goto(1)"
          >
            &laquo;
          </button>
          &nbsp;
          <button type="button" 
            aria-label="Previous page" 
            tabindex="0"
            class="ivpt-paginator-button" 
            [disabled]="_pageCurrent===1"
            [attr.aria-disabled]="_pageCurrent===1" 
            (click)="goto(_pageCurrent-1)"
          >
            &lsaquo;
          </button> &nbsp;
          <input
            class="pagination-current clr-input"
            type="text"
            size="2"
            id="go-to"
            [(ngModel)]="_pageGoto"
            (keydown.enter)="goto(null)"
          />
          &nbsp;/&nbsp;
          <span class="pages-total">
            {{ _pagesTotal }}
          </span>
          &nbsp;
          <button type="button"
            aria-label="Next page" 
            tabindex="0"
            class="ivpt-paginator-button" 
            [disabled]="_pageCurrent===_pagesTotal" 
            [attr.aria-disabled]="_pageCurrent===_pagesTotal" 
            (click)="goto(_pageCurrent + 1)"
          >
            &rsaquo;
          </button>
          &nbsp;
          <button type="button"
            aria-label="Last page" 
            tabindex="0"
            class="ivpt-paginator-button" 
            [disabled]="_pageCurrent===_pagesTotal" 
            [attr.aria-disabled]="_pageCurrent===_pagesTotal" 
            (click)="goto(_pagesTotal)"
          >
            &raquo;
          </button>
        </div>
        }
      </div>
    }
  </ng-template>
</div>
