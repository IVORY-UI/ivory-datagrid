import { Component, Input, Output, EventEmitter } from '@angular/core';
import * as i0 from "@angular/core";
import * as i1 from "../../services/page-manager.service";
import * as i2 from "@angular/forms";
export class PresentablePaginatorComponent {
    set recordsPerPageOptions(value) {
        this._records.options = value;
    }
    set recordsPerPage(value) {
        this._records.perPage = value;
    }
    set recordsTotal(value) {
        this._records.total = value;
        this._page.total = Math.ceil(this._records.total / this._records.perPage);
        this._showPagination = this._records.total > this._records.perPage;
    }
    constructor(pageManager) {
        this.pageManager = pageManager;
        this._showPagination = false;
        this._records = {};
        this._page = {
            'total': 1,
            'current': 1,
            'goto': 1
        };
        this.pageChange = new EventEmitter();
    }
    ngOnInit() {
        // The below current page subscription is being used only for the pagination reset usecase
        this.pageManager.currentPage$.subscribe((value) => {
            this._page.current = this._page.goto = value;
        });
    }
    updatePerPageRecords() {
        this._page.goto = this._page.current = 1;
        this._page.total = Math.ceil(this._records.total / this._records.perPage);
        this.pageChange.emit({ 'from': 1, 'to': this._records.perPage });
    }
    goto(pageNumber) {
        if (pageNumber !== null && pageNumber !== undefined && pageNumber !== this._page.current) {
            const startRecord = (pageNumber - 1) * this._records.perPage;
            const endRecord = ((startRecord + this._records.perPage) > this._records.total) ? this._records.total : startRecord + this._records.perPage;
            this.pageChange.emit({ 'from': startRecord, 'to': endRecord });
            this._page.goto = this._page.current = pageNumber;
        }
        else {
            if (this._page.goto < 1) {
                this._page.goto = 1;
            }
            else if (this._page.goto > this._page.total) {
                this._page.goto = this._page.total;
            }
            this.goto(this._page.goto);
        }
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.2.1", ngImport: i0, type: PresentablePaginatorComponent, deps: [{ token: i1.PageManagerService }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.0.0", version: "17.2.1", type: PresentablePaginatorComponent, selector: "presentable-paginator", inputs: { recordsPerPageOptions: "recordsPerPageOptions", recordsPerPage: "recordsPerPage", recordsTotal: "recordsTotal" }, outputs: { pageChange: "pageChange" }, ngImport: i0, template: "<div class=\"ivpt-records-summary\" role=\"status\">\n  <span>\n    {{((_page.current-1)*_records.perPage)+1}}\n  </span>\n  &nbsp;\n  <span> to </span>\n  &nbsp;\n  <span>\n    @if (_records.total < (_page.current*_records.perPage)) {\n      {{_records.total}}\n    } @else {\n      {{_page.current * _records.perPage}}\n    }\n  </span>\n  &nbsp;\n  <span> of </span>\n  &nbsp;\n  <span>\n    {{_records.total}}\n  </span>\n</div>\n\n<div class=\"ivpt-records-options\" role=\"presentation\">\n  <label for=\"records-per-page\" aria-hidden=\"false\">\n    Records per page: \n  </label>\n  &nbsp;\n  <select name=\"perPageOptions\" \n    id=\"records-per-page\" \n    tabindex=\"0\"\n    [(ngModel)]=\"_records.perPage\" \n    (change)=\"updatePerPageRecords()\"\n  >\n    @for (p of _records.options; track p) {\n      <option [ngValue]=\"p\">\n        {{ p }}\n      </option>\n    }\n  </select>\n</div>\n\n<div class=\"ivpt-records-paging\">\n  @if (_showPagination) {\n    <button type=\"button\" \n      aria-label=\"First page\" \n      tabindex=\"0\"\n      class=\"ivpt-paginator-button\" \n      [disabled]=\"_page.current===1\"\n      [attr.aria-disabled]=\"_page.current===1\"\n      (click)=\"goto(1)\"\n    >\n      &laquo;\n    </button>\n    \n    <button type=\"button\" \n      aria-label=\"Previous page\" \n      tabindex=\"0\"\n      class=\"ivpt-paginator-button\" \n      [disabled]=\"_page.current===1\"\n      [attr.aria-disabled]=\"_page.current===1\" \n      (click)=\"goto(_page.current-1)\"\n    >\n      &lsaquo;\n    </button>\n\n    <input\n      class=\"ivpt-paging-input\"\n      type=\"number\"\n      size=\"2\"\n      [(ngModel)]=\"_page.goto\"\n      (keydown.enter)=\"goto(null)\"\n    />\n    <span>{{ ' / '+_page.total }}</span>\n\n    <button type=\"button\"\n      aria-label=\"Next page\" \n      tabindex=\"0\"\n      class=\"ivpt-paginator-button\" \n      [disabled]=\"_page.current===_page.total\" \n      [attr.aria-disabled]=\"_page.current===_page.total\" \n      (click)=\"goto(_page.current+1)\"\n    >\n      &rsaquo;\n    </button>\n\n    <button type=\"button\"\n      aria-label=\"Last page\" \n      tabindex=\"0\"\n      class=\"ivpt-paginator-button\" \n      [disabled]=\"_page.current===_page.total\" \n      [attr.aria-disabled]=\"_page.current===_page.total\" \n      (click)=\"goto(_page.total)\"\n    >\n      &raquo;\n    </button>\n  }\n</div>\n", styles: [".ivpt-records-paging,.ivpt-records-options,.ivpt-records-summary{display:flex;flex:1;align-items:center}:host{display:flex;width:100%;justify-content:space-between}.ivpt-records-options{justify-content:center}.ivpt-records-paging{justify-content:flex-end}.ivpt-paging-input{width:24px;margin:0 .5rem;-moz-appearance:textfield}.ivpt-paging-input::-webkit-inner-spin-button,.ivpt-paging-input::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}.ivpt-paginator-button{border:none;border-radius:.25rem;background-color:#c8dbee;height:1.5rem;line-height:1.5rem;padding:0 .5rem;cursor:pointer;margin:0 0 0 12px}.ivpt-paginator-button:hover,.ivpt-paginator-button:focus{background-color:#859fb4}\n"], dependencies: [{ kind: "directive", type: i2.NgSelectOption, selector: "option", inputs: ["ngValue", "value"] }, { kind: "directive", type: i2.ɵNgSelectMultipleOption, selector: "option", inputs: ["ngValue", "value"] }, { kind: "directive", type: i2.DefaultValueAccessor, selector: "input:not([type=checkbox])[formControlName],textarea[formControlName],input:not([type=checkbox])[formControl],textarea[formControl],input:not([type=checkbox])[ngModel],textarea[ngModel],[ngDefaultControl]" }, { kind: "directive", type: i2.NumberValueAccessor, selector: "input[type=number][formControlName],input[type=number][formControl],input[type=number][ngModel]" }, { kind: "directive", type: i2.SelectControlValueAccessor, selector: "select:not([multiple])[formControlName],select:not([multiple])[formControl],select:not([multiple])[ngModel]", inputs: ["compareWith"] }, { kind: "directive", type: i2.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { kind: "directive", type: i2.NgModel, selector: "[ngModel]:not([formControlName]):not([formControl])", inputs: ["name", "disabled", "ngModel", "ngModelOptions"], outputs: ["ngModelChange"], exportAs: ["ngModel"] }] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.2.1", ngImport: i0, type: PresentablePaginatorComponent, decorators: [{
            type: Component,
            args: [{ selector: 'presentable-paginator', template: "<div class=\"ivpt-records-summary\" role=\"status\">\n  <span>\n    {{((_page.current-1)*_records.perPage)+1}}\n  </span>\n  &nbsp;\n  <span> to </span>\n  &nbsp;\n  <span>\n    @if (_records.total < (_page.current*_records.perPage)) {\n      {{_records.total}}\n    } @else {\n      {{_page.current * _records.perPage}}\n    }\n  </span>\n  &nbsp;\n  <span> of </span>\n  &nbsp;\n  <span>\n    {{_records.total}}\n  </span>\n</div>\n\n<div class=\"ivpt-records-options\" role=\"presentation\">\n  <label for=\"records-per-page\" aria-hidden=\"false\">\n    Records per page: \n  </label>\n  &nbsp;\n  <select name=\"perPageOptions\" \n    id=\"records-per-page\" \n    tabindex=\"0\"\n    [(ngModel)]=\"_records.perPage\" \n    (change)=\"updatePerPageRecords()\"\n  >\n    @for (p of _records.options; track p) {\n      <option [ngValue]=\"p\">\n        {{ p }}\n      </option>\n    }\n  </select>\n</div>\n\n<div class=\"ivpt-records-paging\">\n  @if (_showPagination) {\n    <button type=\"button\" \n      aria-label=\"First page\" \n      tabindex=\"0\"\n      class=\"ivpt-paginator-button\" \n      [disabled]=\"_page.current===1\"\n      [attr.aria-disabled]=\"_page.current===1\"\n      (click)=\"goto(1)\"\n    >\n      &laquo;\n    </button>\n    \n    <button type=\"button\" \n      aria-label=\"Previous page\" \n      tabindex=\"0\"\n      class=\"ivpt-paginator-button\" \n      [disabled]=\"_page.current===1\"\n      [attr.aria-disabled]=\"_page.current===1\" \n      (click)=\"goto(_page.current-1)\"\n    >\n      &lsaquo;\n    </button>\n\n    <input\n      class=\"ivpt-paging-input\"\n      type=\"number\"\n      size=\"2\"\n      [(ngModel)]=\"_page.goto\"\n      (keydown.enter)=\"goto(null)\"\n    />\n    <span>{{ ' / '+_page.total }}</span>\n\n    <button type=\"button\"\n      aria-label=\"Next page\" \n      tabindex=\"0\"\n      class=\"ivpt-paginator-button\" \n      [disabled]=\"_page.current===_page.total\" \n      [attr.aria-disabled]=\"_page.current===_page.total\" \n      (click)=\"goto(_page.current+1)\"\n    >\n      &rsaquo;\n    </button>\n\n    <button type=\"button\"\n      aria-label=\"Last page\" \n      tabindex=\"0\"\n      class=\"ivpt-paginator-button\" \n      [disabled]=\"_page.current===_page.total\" \n      [attr.aria-disabled]=\"_page.current===_page.total\" \n      (click)=\"goto(_page.total)\"\n    >\n      &raquo;\n    </button>\n  }\n</div>\n", styles: [".ivpt-records-paging,.ivpt-records-options,.ivpt-records-summary{display:flex;flex:1;align-items:center}:host{display:flex;width:100%;justify-content:space-between}.ivpt-records-options{justify-content:center}.ivpt-records-paging{justify-content:flex-end}.ivpt-paging-input{width:24px;margin:0 .5rem;-moz-appearance:textfield}.ivpt-paging-input::-webkit-inner-spin-button,.ivpt-paging-input::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}.ivpt-paginator-button{border:none;border-radius:.25rem;background-color:#c8dbee;height:1.5rem;line-height:1.5rem;padding:0 .5rem;cursor:pointer;margin:0 0 0 12px}.ivpt-paginator-button:hover,.ivpt-paginator-button:focus{background-color:#859fb4}\n"] }]
        }], ctorParameters: () => [{ type: i1.PageManagerService }], propDecorators: { recordsPerPageOptions: [{
                type: Input
            }], recordsPerPage: [{
                type: Input
            }], recordsTotal: [{
                type: Input
            }], pageChange: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJlc2VudGFibGUtcGFnaW5hdG9yLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2l2b3J5LXByZXNlbnRhYmxlL3NyYy9saWIvY29tcG9uZW50cy9wcmVzZW50YWJsZS1wYWdpbmF0b3IvcHJlc2VudGFibGUtcGFnaW5hdG9yLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2l2b3J5LXByZXNlbnRhYmxlL3NyYy9saWIvY29tcG9uZW50cy9wcmVzZW50YWJsZS1wYWdpbmF0b3IvcHJlc2VudGFibGUtcGFnaW5hdG9yLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsTUFBTSxlQUFlLENBQUM7Ozs7QUFldkUsTUFBTSxPQUFPLDZCQUE2QjtJQVV4QyxJQUNJLHFCQUFxQixDQUFDLEtBQVU7UUFDbEMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPLEdBQUcsS0FBSyxDQUFDO0lBQ2hDLENBQUM7SUFFRCxJQUNJLGNBQWMsQ0FBQyxLQUFhO1FBQzlCLElBQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxHQUFHLEtBQUssQ0FBQztJQUNoQyxDQUFDO0lBRUQsSUFDSSxZQUFZLENBQUMsS0FBYTtRQUM1QixJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7UUFDNUIsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQzFFLElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUM7SUFD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QUFZO3NCQURmLEtBQUs7Z0JBT0ksVUFBVTtzQkFBbkIsTUFBTSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgSW5wdXQsIE91dHB1dCwgRXZlbnRFbWl0dGVyIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbmltcG9ydCB7IFBhZ2VNYW5hZ2VyU2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL3BhZ2UtbWFuYWdlci5zZXJ2aWNlJztcblxudHlwZSBQYWdlID0ge1xuICB0b3RhbDogbnVtYmVyO1xuICBjdXJyZW50OiBudW1iZXI7XG4gIGdvdG86IG51bWJlcjtcbn07XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3ByZXNlbnRhYmxlLXBhZ2luYXRvcicsXG4gIHRlbXBsYXRlVXJsOiAnLi9wcmVzZW50YWJsZS1wYWdpbmF0b3IuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybDogJy4vcHJlc2VudGFibGUtcGFnaW5hdG9yLmNvbXBvbmVudC5zY3NzJ1xufSlcbmV4cG9ydCBjbGFzcyBQcmVzZW50YWJsZVBhZ2luYXRvckNvbXBvbmVudCB7XG5cbiAgX3Nob3dQYWdpbmF0aW9uOiBib29sZWFuID0gZmFsc2U7XG4gIF9yZWNvcmRzOiBhbnkgPSB7fTtcbiAgX3BhZ2U6IFBhZ2UgPSB7XG4gICAgJ3RvdGFsJzogMSxcbiAgICAnY3VycmVudCc6IDEsXG4gICAgJ2dvdG8nOiAxXG4gIH07XG5cbiAgQElucHV0KCkgXG4gIHNldCByZWNvcmRzUGVyUGFnZU9wdGlvbnModmFsdWU6IGFueSkge1xuICAgIHRoaXMuX3JlY29yZHMub3B0aW9ucyA9IHZhbHVlO1xuICB9XG5cbiAgQElucHV0KCkgXG4gIHNldCByZWNvcmRzUGVyUGFnZSh2YWx1ZTogbnVtYmVyKSB7XG4gICAgdGhpcy5fcmVjb3Jkcy5wZXJQYWdlID0gdmFsdWU7XG4gIH1cblxuICBASW5wdXQoKSBcbiAgc2V0IHJlY29yZHNUb3RhbCh2YWx1ZTogbnVtYmVyKSB7XG4gICAgdGhpcy5fcmVjb3Jkcy50b3RhbCA9IHZhbHVlO1xuICAgIHRoaXMuX3BhZ2UudG90YWwgPSBNYXRoLmNlaWwodGhpcy5fcmVjb3Jkcy50b3RhbCAvIHRoaXMuX3JlY29yZHMucGVyUGFnZSk7XG4gICAgdGhpcy5fc2hvd1BhZ2luYXRpb24gPSB0aGlzLl9yZWNvcmRzLnRvdGFsID4gdGhpcy5fcmVjb3Jkcy5wZXJQYWdlO1xuICB9XG5cbiAgQE91dHB1dCgpIHBhZ2VDaGFuZ2U6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHB1YmxpYyBwYWdlTWFuYWdlcjogUGFnZU1hbmFnZXJTZXJ2aWNlXG4gICkge31cblxuICBuZ09uSW5pdCgpIHtcbiAgICAvLyBUaGUgYmVsb3cgY3VycmVudCBwYWdlIHN1YnNjcmlwdGlvbiBpcyBiZWluZyB1c2VkIG9ubHkgZm9yIHRoZSBwYWdpbmF0aW9uIHJlc2V0IHVzZWNhc2VcbiAgICB0aGlzLnBhZ2VNYW5hZ2VyLmN1cnJlbnRQYWdlJC5zdWJzY3JpYmUoKHZhbHVlOiBudW1iZXIpID0+IHtcbiAgICAgIHRoaXMuX3BhZ2UuY3VycmVudCA9IHRoaXMuX3BhZ2UuZ290byA9IHZhbHVlO1xuICAgIH0pO1xuICB9XG5cbiAgdXBkYXRlUGVyUGFnZVJlY29yZHMoKSB7XG4gICAgdGhpcy5fcGFnZS5nb3RvID0gdGhpcy5fcGFnZS5jdXJyZW50ID0gMTtcbiAgICB0aGlzLl9wYWdlLnRvdGFsID0gTWF0aC5jZWlsKHRoaXMuX3JlY29yZHMudG90YWwgLyB0aGlzLl9yZWNvcmRzLnBlclBhZ2UpO1xuICAgIHRoaXMucGFnZUNoYW5nZS5lbWl0KHsgJ2Zyb20nOiAxLCAndG8nOiB0aGlzLl9yZWNvcmRzLnBlclBhZ2UgfSlcbiAgfVxuICBcbiAgZ290byhwYWdlTnVtYmVyOiBudW1iZXIgfCBudWxsKSB7XG4gICAgaWYgKHBhZ2VOdW1iZXIhPT1udWxsICYmIHBhZ2VOdW1iZXIhPT11bmRlZmluZWQgJiYgcGFnZU51bWJlciE9PXRoaXMuX3BhZ2UuY3VycmVudCkgeyBcbiAgICAgIGNvbnN0IHN0YXJ0UmVjb3JkID0gKHBhZ2VOdW1iZXItMSkgKiB0aGlzLl9yZWNvcmRzLnBlclBhZ2U7XG4gICAgICBjb25zdCBlbmRSZWNvcmQgPSAoKHN0YXJ0UmVjb3JkK3RoaXMuX3JlY29yZHMucGVyUGFnZSkgPiB0aGlzLl9yZWNvcmRzLnRvdGFsKSA/IHRoaXMuX3JlY29yZHMudG90YWwgOiBzdGFydFJlY29yZCArIHRoaXMuX3JlY29yZHMucGVyUGFnZTtcbiAgICAgIHRoaXMucGFnZUNoYW5nZS5lbWl0KHsgJ2Zyb20nOiBzdGFydFJlY29yZCwgJ3RvJzogZW5kUmVjb3JkIH0pO1xuXG4gICAgICB0aGlzLl9wYWdlLmdvdG8gPSB0aGlzLl9wYWdlLmN1cnJlbnQgPSBwYWdlTnVtYmVyO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAodGhpcy5fcGFnZS5nb3RvIDwgMSkge1xuICAgICAgICB0aGlzLl9wYWdlLmdvdG8gPSAxO1xuICAgICAgfSBlbHNlIGlmICh0aGlzLl9wYWdlLmdvdG8gPiB0aGlzLl9wYWdlLnRvdGFsKSB7XG4gICAgICAgIHRoaXMuX3BhZ2UuZ290byA9IHRoaXMuX3BhZ2UudG90YWw7XG4gICAgICB9XG4gICAgICB0aGlzLmdvdG8odGhpcy5fcGFnZS5nb3RvKTtcbiAgICB9XG4gIH1cblxufVxuIiwiPGRpdiBjbGFzcz1cIml2cHQtcmVjb3Jkcy1zdW1tYXJ5XCIgcm9sZT1cInN0YXR1c1wiPlxuICA8c3Bhbj5cbiAgICB7eygoX3BhZ2UuY3VycmVudC0xKSpfcmVjb3Jkcy5wZXJQYWdlKSsxfX1cbiAgPC9zcGFuPlxuICAmbmJzcDtcbiAgPHNwYW4+IHRvIDwvc3Bhbj5cbiAgJm5ic3A7XG4gIDxzcGFuPlxuICAgIEBpZiAoX3JlY29yZHMudG90YWwgPCAoX3BhZ2UuY3VycmVudCpfcmVjb3Jkcy5wZXJQYWdlKSkge1xuICAgICAge3tfcmVjb3Jkcy50b3RhbH19XG4gICAgfSBAZWxzZSB7XG4gICAgICB7e19wYWdlLmN1cnJlbnQgKiBfcmVjb3Jkcy5wZXJQYWdlfX1cbiAgICB9XG4gIDwvc3Bhbj5cbiAgJm5ic3A7XG4gIDxzcGFuPiBvZiA8L3NwYW4+XG4gICZuYnNwO1xuICA8c3Bhbj5cbiAgICB7e19yZWNvcmRzLnRvdGFsfX1cbiAgPC9zcGFuPlxuPC9kaXY+XG5cbjxkaXYgY2xhc3M9XCJpdnB0LXJlY29yZHMtb3B0aW9uc1wiIHJvbGU9XCJwcmVzZW50YXRpb25cIj5cbiAgPGxhYmVsIGZvcj1cInJlY29yZHMtcGVyLXBhZ2VcIiBhcmlhLWhpZGRlbj1cImZhbHNlXCI+XG4gICAgUmVjb3JkcyBwZXIgcGFnZTogXG4gIDwvbGFiZWw+XG4gICZuYnNwO1xuICA8c2VsZWN0IG5hbWU9XCJwZXJQYWdlT3B0aW9uc1wiIFxuICAgIGlkPVwicmVjb3Jkcy1wZXItcGFnZVwiIFxuICAgIHRhYmluZGV4PVwiMFwiXG4gICAgWyhuZ01vZGVsKV09XCJfcmVjb3Jkcy5wZXJQYWdlXCIgXG4gICAgKGNoYW5nZSk9XCJ1cGRhdGVQZXJQYWdlUmVjb3JkcygpXCJcbiAgPlxuICAgIEBmb3IgKHAgb2YgX3JlY29yZHMub3B0aW9uczsgdHJhY2sgcCkge1xuICAgICAgPG9wdGlvbiBbbmdWYWx1ZV09XCJwXCI+XG4gICAgICAgIHt7IHAgfX1cbiAgICAgIDwvb3B0aW9uPlxuICAgIH1cbiAgPC9zZWxlY3Q+XG48L2Rpdj5cblxuPGRpdiBjbGFzcz1cIml2cHQtcmVjb3Jkcy1wYWdpbmdcIj5cbiAgQGlmIChfc2hvd1BhZ2luYXRpb24pIHtcbiAgICA8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBcbiAgICAgIGFyaWEtbGFiZWw9XCJGaXJzdCBwYWdlXCIgXG4gICAgICB0YWJpbmRleD1cIjBcIlxuICAgICAgY2xhc3M9XCJpdnB0LXBhZ2luYXRvci1idXR0b25cIiBcbiAgICAgIFtkaXNhYmxlZF09XCJfcGFnZS5jdXJyZW50PT09MVwiXG4gICAgICBbYXR0ci5hcmlhLWRpc2FibGVkXT1cIl9wYWdlLmN1cnJlbnQ9PT0xXCJcbiAgICAgIChjbGljayk9XCJnb3RvKDEpXCJcbiAgICA+XG4gICAgICAmbGFxdW87XG4gICAgPC9idXR0b24+XG4gICAgXG4gICAgPGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgXG4gICAgICBhcmlhLWxhYmVsPVwiUHJldmlvdXMgcGFnZVwiIFxuICAgICAgdGFiaW5kZXg9XCIwXCJcbiAgICAgIGNsYXNzPVwiaXZwdC1wYWdpbmF0b3ItYnV0dG9uXCIgXG4gICAgICBbZGlzYWJsZWRdPVwiX3BhZ2UuY3VycmVudD09PTFcIlxuICAgICAgW2F0dHIuYXJpYS1kaXNhYmxlZF09XCJfcGFnZS5jdXJyZW50PT09MVwiIFxuICAgICAgKGNsaWNrKT1cImdvdG8oX3BhZ2UuY3VycmVudC0xKVwiXG4gICAgPlxuICAgICAgJmxzYXF1bztcbiAgICA8L2J1dHRvbj5cblxuICAgIDxpbnB1dFxuICAgICAgY2xhc3M9XCJpdnB0LXBhZ2luZy1pbnB1dFwiXG4gICAgICB0eXBlPVwibnVtYmVyXCJcbiAgICAgIHNpemU9XCIyXCJcbiAgICAgIFsobmdNb2RlbCldPVwiX3BhZ2UuZ290b1wiXG4gICAgICAoa2V5ZG93bi5lbnRlcik9XCJnb3RvKG51bGwpXCJcbiAgICAvPlxuICAgIDxzcGFuPnt7ICcgLyAnK19wYWdlLnRvdGFsIH19PC9zcGFuPlxuXG4gICAgPGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCJcbiAgICAgIGFyaWEtbGFiZWw9XCJOZXh0IHBhZ2VcIiBcbiAgICAgIHRhYmluZGV4PVwiMFwiXG4gICAgICBjbGFzcz1cIml2cHQtcGFnaW5hdG9yLWJ1dHRvblwiIFxuICAgICAgW2Rpc2FibGVkXT1cIl9wYWdlLmN1cnJlbnQ9PT1fcGFnZS50b3RhbFwiIFxuICAgICAgW2F0dHIuYXJpYS1kaXNhYmxlZF09XCJfcGFnZS5jdXJyZW50PT09X3BhZ2UudG90YWxcIiBcbiAgICAgIChjbGljayk9XCJnb3RvKF9wYWdlLmN1cnJlbnQrMSlcIlxuICAgID5cbiAgICAgICZyc2FxdW87XG4gICAgPC9idXR0b24+XG5cbiAgICA8YnV0dG9uIHR5cGU9XCJidXR0b25cIlxuICAgICAgYXJpYS1sYWJlbD1cIkxhc3QgcGFnZVwiIFxuICAgICAgdGFiaW5kZXg9XCIwXCJcbiAgICAgIGNsYXNzPVwiaXZwdC1wYWdpbmF0b3ItYnV0dG9uXCIgXG4gICAgICBbZGlzYWJsZWRdPVwiX3BhZ2UuY3VycmVudD09PV9wYWdlLnRvdGFsXCIgXG4gICAgICBbYXR0ci5hcmlhLWRpc2FibGVkXT1cIl9wYWdlLmN1cnJlbnQ9PT1fcGFnZS50b3RhbFwiIFxuICAgICAgKGNsaWNrKT1cImdvdG8oX3BhZ2UudG90YWwpXCJcbiAgICA+XG4gICAgICAmcmFxdW87XG4gICAgPC9idXR0b24+XG4gIH1cbjwvZGl2PlxuIl19